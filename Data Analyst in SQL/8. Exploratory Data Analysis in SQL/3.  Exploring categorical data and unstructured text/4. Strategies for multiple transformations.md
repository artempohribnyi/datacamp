# 1. Strategies for Multiple Transformations

You've learned several ways to transform character data. But what do you do when you need to use different transformations on different observations?

# 2. Multiple transformations

Here's an example of data where different delimiter characters were used to separate the major industry categories of Agriculture and Education, from the industry subcategories. Sometimes there's a colon, other times there's a pipe character or a dash. We can use the split_part function to separate the category into its two parts, but how can we apply different delimiters to different rows?

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/e0a6ef58-de2d-4113-b88d-2985d603edb3)

# 3. CASE WHEN

One option when you need to apply multiple transformations to subsets of the data that don't overlap is to use a CASE WHEN statement. We want to extract just the initial major category from the category column - the part before a delimiter. To do that, we have a case for each different delimiter: a colon followed by space, a dash surrounded by spaces, and a pipe surrounded by spaces. The last case here goes in the else clause. We use LIKE statements to select the rows with each type of delimiter, then apply the split_part function with the delimiter for those rows. We alias the result of the CASE WHEN statement as major_category. We can then use the major_category we extracted to group and aggregate the data. This allows us to get the number of businesses in each of the two major categories.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/3d0e635a-9f57-441e-a941-d03e3084a8cb)

# 4. Recoding table

Another strategy for situations when you need to apply multiple transformations is to create a temporary table that maps messy values,like those in this fruit table, to recoded, clean, standardized values, like those on the right. You can then use the new recoded values in the standardized column by joining the fruit table to the temporary table. The values in the original column match those in the fav_fruit column.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/cba95003-7840-4efe-b185-d3161ecdc308)

# 5. Step 1: CREATE TEMP TABLE

The first step is to create a temporary table with two columns: original, containing the distinct values of fav_fruit and standardized, which will eventually contain the recoded values. We initially populate the standardized column with the original values.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/a47abd7d-144f-4544-b2e1-47d644e3c106)

# 6. Initial table

Here's what our recode table looks like initially.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/213840d1-db92-4356-b941-fc15e134fa05)

# 7. Step 2: UPDATE values

The next step is to update the recode table using functions to clean up the values in the standardized column. The format of an update statement is UPDATE, then the name of the table, then a SET statement. You SET a column to have new values. Update statements can also include a WHERE clause to choose what rows to update. Without a WHERE clause, all of the rows will be updated.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/c536981f-e4a1-4d36-8bdb-4fcae86708c8)

# 8. Step 2: UPDATE values

Here, we need three update statements. In the first, we set the standardized value to be the lower case version of the original value, with spaces trimmed from both ends. In the second, we set the standardized value to banana only for rows that contained a double n. The third statement updates the standardized value by removing s's from the end with the trim function.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/eab35a52-c7ad-4e93-acd7-b3b8aba5dd7a)

# 9. Resulting recode table

Now the recode table contains clean, standardized values.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/20d0dcd2-e5ee-4165-9bcc-b20885d8cd5b)

# 10. Step 3: JOIN original and recode tables

The final step is to use the recode table by joining it to the original data. On the left, without the recoded data, we have many different values of apple and banana even when we group by fav_fruit. On the right, we join the messy fruit table to the recode table by matching the original values. We select and group by the new standardized values to get a much more useful summary of the data.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/7fd0237d-d70f-47cb-a494-afd77c64aa17)

# 11. Recap

To recap, we first created a temporary table to store our standardized values, then updated that table to fix errors and clean up the data. Finally, we used joined the original data to the temporary table to use the clean, standardized values in the query instead of the original values.

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/fbd349b9-8872-4ebb-bd5a-0287ed6d7886)

# 12. Clean up the Evanston 311 data!

Temporary tables and CASE WHEN statements can also be useful in other situations. Time to practice using them to clean up the Evanston 311 data.

# Create an "other" category

If we want to summarize Evanston 311 requests by zip code, it would be useful to group all of the low frequency zip codes together in an "other" category.

Which of the following values, when substituted for ??? in the query, would give the result below?

Query:

SELECT CASE WHEN zipcount < ??? THEN 'other'
       ELSE zip
       END AS zip_recoded,
       sum(zipcount) AS zipsum
  FROM (SELECT zip, count(*) AS zipcount
          FROM evanston311
         GROUP BY zip) AS fullcounts
 GROUP BY zip_recoded
 ORDER BY zipsum DESC;
Result:

zip_recoded    zipsum
60201          19054
60202          11165
null           5528
other          429
60208          255

```
SELECT CASE WHEN zipcount < 255 THEN 'other'
       ELSE zip
       END AS zip_recoded,
       sum(zipcount) AS zipsum
  FROM (SELECT zip, count(*) AS zipcount
          FROM evanston311
         GROUP BY zip) AS fullcounts
 GROUP BY zip_recoded
 ORDER BY zipsum DESC;
```
![image](https://github.com/artempohribnyi/datacamp/assets/113499718/2206041c-dde4-4ac2-bf49-7851181d3096)

![image](https://github.com/artempohribnyi/datacamp/assets/113499718/59b04eaa-1c52-4412-87a2-8187428de017)











